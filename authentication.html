<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/style.css?t=90051322">
    <link rel="stylesheet" href="styles.css?t=6eea839d">
    <script src="assets/script.js?t=93f1a66c"></script>
    <script src="scripts.js?t=bafb4b9e"></script>
    <script src="sharetribe-flex-sdk-web.js?t=b4b99c3d"></script>
    <title>Authentication - Sharetribe SDK for JavaScript</title>
    <meta name="viewport" content="width=device-width">
  </head>
  <body class="-menu-visible">
    <div class="doc-layout">
      <div class="toggle menu-toggle js-menu-toggle"></div>
      <div class="menu toc-menu">
        <ul>
          <li class="menu-item -level-0 -parent">
            <ul class="submenu">
              <li class="menu-item -level-1"><a class="link title  link-index" href="index.html">Sharetribe SDK for JavaScript</a>
              </li>
              <li class="menu-item -level-1"><a class="link title  link-features" href="features.html">Features</a>
              </li>
              <li class="menu-item -level-1"><a class="link title  link-try-it-in-browser" href="try-it-in-browser.html">Try it in browser!</a>
              </li>
              <li class="menu-item -level-1"><a class="link title  link-try-it-in-the-playground" href="try-it-in-the-playground.html">Try it in the API Playground!</a>
              </li>
              <li class="menu-item -level-1 -parent"><span class="title">Getting started</span>
                <ul class="submenu">
                  <li class="menu-item -level-2"><a class="link title -active link-authentication" href="authentication.html">Authentication</a>
                    <ul class="headings heading-list">
                      <li class="heading-item -depth-2"><a class="hlink link-login" href="#login">Login</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-logout" href="#logout">Logout</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-login-as" href="#login-as">Login As</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-login-with-idp" href="#login-with-idp">Login with IdP</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-determine-if-user-is-logged-in" href="#determine-if-user-is-logged-in">Determine if user is logged in</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-authentication-example" href="#authentication-example">Authentication example</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-exchange-token" href="#exchange-token">Exchange token</a>
                      </li>
                      <li class="heading-item -depth-2"><a class="hlink link-seeing-occasional-401-errors" href="#seeing-occasional-401-errors">Seeing occasional 401 errors?</a>
                      </li>
                    </ul>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-calling-the-api" href="calling-the-api.html">Calling the Marketplace API</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-calling-the-asset-delivery-api" href="calling-the-asset-delivery-api.html">Calling the Asset Delivery API</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-types" href="types.html">Types</a>
                  </li>
                </ul>
              </li>
              <li class="menu-item -level-1 -parent"><span class="title">Advanced</span>
                <ul class="submenu">
                  <li class="menu-item -level-2"><a class="link title  link-configurations" href="configurations.html">Configurations</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-your-own-types" href="your-own-types.html">Your own types</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-serializing-types-to-json" href="serializing-types-to-json.html">Serializing types to JSON</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-object-query-parameters" href="object-query-parameters.html">Object query parameters</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-token-store" href="token-store.html">Token store</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-sharing-session-between-client-and-server" href="sharing-session-between-client-and-server.html">Sharing session between client and server</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-keep-alive" href="keep-alive.html">Keep-Alive</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title  link-writing-your-own-token-store" href="writing-your-own-token-store.html">Writing your own token store</a>
                  </li>
                </ul>
              </li>
              <li class="menu-item -level-1"><a class="link title  link-developing-sdk" href="developing-sdk.html">Developing SDK</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div class="body page-authentication">
        <div class="header-nav">
          <div class="right"><a class="iconlink" href="https://github.com/sharetribe/flex-sdk-js" data-title="sharetribe/flex-sdk-js">
              <!-- span.title Open in GitHub--><span class="icon -github"></span></a>
          </div>
        </div>
        <div class="markdown-body"><h1 id="authentication">Authentication</h1>
<p>The SDK provides methods to log the user in and out and determine if
the user is already logged in or not.</p>
<h2 id="login">Login</h2>
<p><strong><code>sdk.login({ username: string, password: string }) : Promise</code></strong></p>
<p>Logs in the user and returns a Promise.</p>
<p>The session information will be saved to the SDK instance when the
Promise is resolved. Subsequent requests will be made as the logged in
user.</p>
<h2 id="logout">Logout</h2>
<p><strong><code>sdk.logout() : Promise</code></strong></p>
<p>Logs out the user and returns a Promise.</p>
<p><strong>Trobleshooting:</strong> In case you&apos;re testing locally from <code>file:///</code>,
the session information may not be saved after successful login. In
this case, you should configure the SDK to use <a href="token-store.html#memory-store">memory-based token
store</a>.</p>
<h2 id="login-as">Login As</h2>
<p><strong><code>sdk.loginAs({ code: string, redirect_uri: string, code_verifier: string }) : Promise</code></strong></p>
<p>Logs in the marketplace operator as the marketplace user and returns a Promise.</p>
<p>The session information will be saved to the SDK instance when the
Promise is resolved. Subsequent requests will be made as the logged in
user.</p>
<h2 id="login-with-idp">Login with IdP</h2>
<p><strong><code>sdk.loginWithIdp({ idpId: string, idpClientId: string, idpToken: string }) : Promise</code></strong></p>
<p>Logs in the user with information from an identity provider (e.g. Facebook) and
returns a Promise. User can be authenticated if the <code>idpToken</code> can be verified
and an identity provider account resolved from the token is associated with a
Sharetribe account or if an email address resolved from the token matches a verified
email of a Sharetribe account.</p>
<p><code>sdk.loginWithIdp</code> requires that the SDK instance is initialized with a
<code>clientSecret</code> attribute.</p>
<p>The session information will be saved to the SDK instance when the
Promise is resolved. Subsequent requests will be made as the logged in
user.</p>
<h2 id="determine-if-user-is-logged-in">Determine if user is logged in</h2>
<p><strong><code>sdk.authInfo() : Promise(Object)</code></strong></p>
<p>Returns a Promise with an Object as a value. The object may contain the following fields:</p>
<ul>
<li><code>scopes</code>: an array containing the scopes associated with the currently stored token</li>
<li><code>isAnonymous</code>: a boolean denoting if the currently stored token only allows public read access</li>
<li><code>isLoggedInAs</code>: a boolean denoting if the marketplace operator is logged in as a marketplace user</li>
</ul>
<p>To determine if the user is logged in, check if <code>isAnonymous</code> equals
<code>false</code>.</p>
<p><strong>Example:</strong></p>
<pre><code class="lang-js">sdk.authInfo().then(<span class="hljs-function"><span class="hljs-params">authInfo</span> =&gt;</span> {
  <span class="pl-k">if</span> (authInfo &amp;&amp; authInfo.isAnonymous === <span class="pl-c1">false</span>) {
    <span class="pl-c1">console</span>.log(<span class="pl-s">&quot;User is logged in.&quot;</span>);
  } <span class="pl-k">else</span> {
    <span class="pl-c1">console</span>.log(<span class="pl-s">&quot;User is NOT logged in.&quot;</span>)
  }
};
</code></pre>
<p><strong>Please note:</strong> Even thought the <code>authInfo</code> method returns a Promise,
the method does not call the API. The authentication information is
saved locally in the <a href="token-store.html">token store</a>.</p>
<p><strong>Please note:</strong> The token store does not store any other user
information in addition to the authentication token. If you need, for
example, to know the name of the logged in user, you need to call
<code>sdk.current_user.show()</code>, which calls the corresponding API endpoint.</p>
<h2 id="authentication-example">Authentication example</h2>
<p>Here&apos;s a full example how to log user in and out and determine the
current authentication status.</p>
<p><strong>Example:</strong></p>
<pre><code class="lang-js"><span class="pl-k">const</span> isLoggedIn = <span class="hljs-function">(<span class="hljs-params">authInfo</span>) =&gt;</span> authInfo &amp;&amp; authInfo.isAnonymous === <span class="pl-c1">false</span>;

sdk
  .authInfo()
  .then(<span class="hljs-function">(<span class="hljs-params">authInfo</span>) =&gt;</span> {
    <span class="pl-c1">console</span>.log(<span class="pl-s">`Logged in: <span class="hljs-subst">${isLoggedIn(authInfo)}</span>`</span>);
    <span class="pl-c">// prints: &quot;Logged in: false&quot;</span>

    <span class="pl-k">return</span> sdk.login({
      <span class="hljs-attr">username</span>: <span class="pl-s">&quot;test-user@example.com&quot;</span>,
      <span class="hljs-attr">password</span>: <span class="pl-s">&quot;test-secret&quot;</span>,
    });
  })
  .then(<span class="hljs-function">(<span class="hljs-params">loginRes</span>) =&gt;</span> {
    <span class="pl-c1">console</span>.log(<span class="pl-s">&quot;Login successful!&quot;</span>);

    <span class="pl-k">return</span> sdk.authInfo();
  })
  .then(<span class="hljs-function">(<span class="hljs-params">authInfo</span>) =&gt;</span> {
    <span class="pl-c1">console</span>.log(<span class="pl-s">`Logged in: <span class="hljs-subst">${isLoggedIn(authInfo)}</span>`</span>);
    <span class="pl-c">// prints: &quot;Logged in: true&quot;</span>

    <span class="pl-k">return</span> sdk.currentUser.show();
  })
  .then(<span class="hljs-function">(<span class="hljs-params">userRes</span>) =&gt;</span> {
    <span class="pl-k">const</span> profile = userRes.data.data.attributes.profile;
    <span class="pl-c1">console</span>.log(<span class="pl-s">`Current user: <span class="hljs-subst">${profile.firstName}</span> <span class="hljs-subst">${profile.lastName}</span>`</span>);

    <span class="pl-k">return</span> sdk.logout();
  })
  .then(<span class="hljs-function">(<span class="hljs-params">logoutRes</span>) =&gt;</span> {
    <span class="pl-c1">console</span>.log(<span class="pl-s">&quot;Logged out!&quot;</span>);

    <span class="pl-k">return</span> sdk.authInfo();
  })
  .then(<span class="hljs-function">(<span class="hljs-params">authInfo</span>) =&gt;</span> {
    <span class="pl-c1">console</span>.log(<span class="pl-s">`Logged in: <span class="hljs-subst">${isLoggedIn(authInfo)}</span>`</span>);
    <span class="pl-c">// prints: &quot;Logged in: false&quot;</span>
  })
  .catch(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="pl-c">// An error occurred</span>
    <span class="pl-c1">console</span>.log(<span class="pl-s">`Request failed with status: <span class="hljs-subst">${res.status}</span> <span class="hljs-subst">${res.statusText}</span>`</span>);
  });
</code></pre>
<h2 id="exchange-token">Exchange token</h2>
<p><strong><code>sdk.exchangeToken() : Promise</code></strong></p>
<p>A valid access token can be exchanged to a trusted token when combined with a client
secret. A trusted token is required by the Sharetribe APIs for certain requests, for
example, <a href="https://www.sharetribe.com/docs/background/privileged-transitions/">privileged
transitions</a>.</p>
<p>In order to exchange an access token, a valid access token needs to be stored in
the SDK&apos;s token store. This can be achieved by logging in or by initializing the
SDK with a token store that holds an access token.</p>
<p><strong>Example:</strong></p>
<pre><code class="lang-js"><span class="pl-k">const</span> sdk = sharetribeSdk.createInstance({
  <span class="hljs-attr">clientId</span>: <span class="pl-s">&quot;a client ID&quot;</span>,
  <span class="hljs-attr">clientSecret</span>: <span class="pl-s">&quot;a client secret&quot;</span>,
  <span class="hljs-attr">tokenStore</span>: sharetribeSdk.tokenStore.memoryStore(),
});

sdk.login({ <span class="hljs-attr">username</span>: <span class="pl-s">&quot;test-user@example.com&quot;</span>, <span class="hljs-attr">password</span>: <span class="pl-s">&quot;test-secret&quot;</span> });

sdk.exchangeToken().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
  <span class="pl-c1">console</span>.log(<span class="pl-s">&quot;Trusted token: &quot;</span>, res.data);
});
</code></pre>
<h2 id="seeing-occasional-401-errors">Seeing occasional 401 errors?</h2>
<p>Are you seeing occasional 401 errors in the browser&apos;s Web Console?
Don&apos;t worry! That&apos;s part of the normal operations.</p>
<p>Sharetribe API uses two authentication tokens for each session:</p>
<ul>
<li><em>Access token</em> that is used to authenticate the user. Valid only a
short amount of time.</li>
<li><em>Refresh token</em> that is used to issue a fresh authentication
token. Long lived.</li>
</ul>
<p>When <em>access token</em> expires, you will see a 401 error in browser&apos;s Web
Console. The SDK will handle this and automatically issue new fresh
authentication token and retry the request. This all happens under the
hood and you don&apos;t need to worry about it. SDK will do the heavy
lifting.</p>
<p>See <a href="https://www.sharetribe.com/api-reference/authentication.html">Authentication API reference
document</a>
for more information.</p>

        </div>
        <div class="footer-nav">
          <div class="left"><a href="try-it-in-the-playground.html"><span class="title">Try it in the API Playground!</span></a></div>
          <div class="right"><a href="calling-the-api.html"><span class="label">Next: </span><span class="title">Calling the Marketplace API</span></a></div>
        </div>
      </div>
    </div>
  </body>
</html>